<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>iPhone Calculator</title>
<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        overflow: hidden;
    }

    .calculator {
        width: 100vw;
        height: 100vh;
        max-width: 400px;
        background-color: #000;
        display: flex;
        flex-direction: column;
    }

    .display {
        padding: 12% 10px 10px;
        text-align: right;
        color: white;
        font-size: 3rem;
        flex: 0 0 auto;
        display: flex;
        align-items: flex-end;
        justify-content: flex-end;
        overflow: hidden;
    }

    .buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-gap: 8px;
        padding: 8px;
        flex: 1 1 auto;
    }

    .btn {
        position: relative;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.8rem;
        cursor: pointer;
        transition: filter 0.2s;
        user-select: none;
        aspect-ratio: 1;
    }

    .btn span {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .btn:active {
        filter: brightness(130%);
    }

    .light-gray { background-color: #a5a5a5; color: #000; }
    .dark-gray { background-color: #333; color: #fff; }
    .orange { background-color: #f1a33c; color: #fff; }
    .orange.active { background-color: #fff; color: #f1a33c; }

    .zero {
        grid-column: span 2;
        border-radius: 55px;
        justify-content: flex-start;
        padding-left: 20%;
    }

    /* History overlay */
    #historyPanel {
        position: fixed;
        top: 0;
        right: -100%;
        width: 70%;
        max-width: 250px;
        height: 100%;
        background-color: #111;
        color: #fff;
        padding: 15px;
        box-shadow: -5px 0 15px rgba(0,0,0,0.5);
        transition: right 0.3s ease;
        overflow-y: auto;
        z-index: 999;
    }

    #historyPanel h3 {
        margin-bottom: 10px;
        text-align: center;
    }

    #historyPanel ul {
        list-style: none;
        padding-left: 0;
    }

    #historyPanel ul li {
        margin-bottom: 8px;
        word-break: break-all;
    }

    #historyPanel.show { right: 0; }

</style>
</head>
<body>

<div class="calculator">
    <div class="display" id="display">0</div>
    <div class="buttons">
        <div class="btn light-gray" data-action="clear"><span>AC</span></div>
        <div class="btn light-gray" data-action="backspace"><span>⌫</span></div>
        <div class="btn light-gray" data-action="percentage"><span>%</span></div>
        <div class="btn orange" data-action="divide"><span>÷</span></div>

        <div class="btn dark-gray" data-number="7"><span>7</span></div>
        <div class="btn dark-gray" data-number="8"><span>8</span></div>
        <div class="btn dark-gray" data-number="9"><span>9</span></div>
        <div class="btn orange" data-action="multiply"><span>×</span></div>

        <div class="btn dark-gray" data-number="4"><span>4</span></div>
        <div class="btn dark-gray" data-number="5"><span>5</span></div>
        <div class="btn dark-gray" data-number="6"><span>6</span></div>
        <div class="btn orange" data-action="subtract"><span>-</span></div>

        <div class="btn dark-gray" data-number="1"><span>1</span></div>
        <div class="btn dark-gray" data-number="2"><span>2</span></div>
        <div class="btn dark-gray" data-number="3"><span>3</span></div>
        <div class="btn orange" data-action="add"><span>+</span></div>

        <div class="btn dark-gray zero" data-number="0"><span>0</span></div>
        <div class="btn dark-gray" data-number="."><span>.</span></div>
        <div class="btn orange" data-action="calculate"><span>=</span></div>
        <div class="btn orange" data-action="history"><span>H</span></div>
    </div>
</div>

<div id="historyPanel">
    <h3>History</h3>
    <ul id="historyList"></ul>
</div>

<script>
class Calculator {
    constructor() {
        this.display = document.getElementById('display');
        this.historyList = document.getElementById('historyList');
        this.historyPanel = document.getElementById('historyPanel');
        this.history = [];
        this.clear();
        this.setupEventListeners();
    }

    clear() {
        this.currentOperand = '0';
        this.previousOperand = '';
        this.operation = undefined;
        this.waitingForNewOperand = false;
        this.updateDisplay();
        this.updateOperationButtons();
    }

    delete() {
        if (this.currentOperand.length === 1 || 
           (this.currentOperand.length === 2 && this.currentOperand.startsWith('-'))) {
            this.currentOperand = '0';
        } else {
            this.currentOperand = this.currentOperand.slice(0, -1);
        }
    }

    appendNumber(number) {
        if (this.waitingForNewOperand) {
            this.currentOperand = number;
            this.waitingForNewOperand = false;
        } else {
            if (number === '.' && this.currentOperand.includes('.')) return;
            if (this.currentOperand === '0' && number !== '.') {
                this.currentOperand = number;
            } else {
                this.currentOperand += number;
            }
        }
    }

    chooseOperation(operation) {
        if (this.currentOperand === '') return;
        if (this.previousOperand !== '') this.calculate();
        this.operation = operation;
        this.previousOperand = this.currentOperand;
        this.waitingForNewOperand = true;
        this.updateOperationButtons();
    }

    calculate() {
        const prev = parseFloat(this.previousOperand);
        const current = parseFloat(this.currentOperand);
        if (isNaN(prev) || isNaN(current)) return;

        let computation;
        switch(this.operation) {
            case '+': computation = prev + current; break;
            case '-': computation = prev - current; break;
            case '×': computation = prev * current; break;
            case '÷': 
                if(current===0){this.currentOperand='Error';this.resetAfterCalc();return;}
                computation = prev / current; break;
            default: return;
        }

        const expression = `${this.previousOperand} ${this.operation} ${this.currentOperand} = ${this.formatResult(computation)}`;
        this.addHistory(expression);

        this.currentOperand = this.formatResult(computation);
        this.resetAfterCalc();
    }

    resetAfterCalc() {
        this.operation = undefined;
        this.previousOperand = '';
        this.waitingForNewOperand = true;
        this.updateDisplay();
        this.updateOperationButtons();
    }

    formatResult(result) {
        if(result===Infinity || isNaN(result)) return 'Error';
        if(!Number.isInteger(result)) result = Math.round(result*1e10)/1e10;
        let str = result.toString();
        if(str.length>10) str = result.toExponential(5);
        return str;
    }

    toggleSign() {
        if(this.currentOperand==='0'||this.currentOperand==='Error') return;
        this.currentOperand = this.currentOperand.startsWith('-') ? this.currentOperand.slice(1) : '-' + this.currentOperand;
    }

    percentage() {
        if(this.currentOperand==='0'||this.currentOperand==='Error') return;
        this.currentOperand = (parseFloat(this.currentOperand)/100).toString();
    }

    addHistory(expr) {
        this.history.unshift(expr);
        if(this.history.length>10) this.history.pop();
        this.renderHistory();
    }

    renderHistory() {
        this.historyList.innerHTML = '';
        this.history.forEach(item=>{
            const li = document.createElement('li');
            li.textContent = item;
            this.historyList.appendChild(li);
        });
    }

    toggleHistoryPanel() {
        this.historyPanel.classList.toggle('show');
    }

    updateDisplay() {
        let displayValue = this.currentOperand;
        if(displayValue.length>10) displayValue = parseFloat(displayValue).toExponential(5);
        this.display.textContent = displayValue;

        const clearBtn = document.querySelector('[data-action="clear"] span');
        clearBtn.textContent = (this.currentOperand!=='0'||this.previousOperand!=='') ? 'C' : 'AC';
    }

    updateOperationButtons() {
        document.querySelectorAll('.btn.orange').forEach(btn=>btn.classList.remove('active'));
        if(this.operation){
            const mapping = {'+':'[data-action="add"]','-':'[data-action="subtract"]','×':'[data-action="multiply"]','÷':'[data-action="divide"]'};
            const btn = document.querySelector(mapping[this.operation]);
            if(btn) btn.classList.add('active');
        }
    }

    setupEventListeners() {
        document.querySelectorAll('[data-number]').forEach(btn=>{
            btn.addEventListener('click',()=>{this.appendNumber(btn.getAttribute('data-number')); this.updateDisplay();});
        });

        document.querySelectorAll('[data-action]').forEach(btn=>{
            btn.addEventListener('click',()=>{
                const action = btn.getAttribute('data-action');
                switch(action){
                    case 'clear': this.clear(); break;
                    case 'backspace': this.delete(); this.updateDisplay(); break;
                    case 'toggleSign': this.toggleSign(); this.updateDisplay(); break;
                    case 'percentage': this.percentage(); this.updateDisplay(); break;
                    case 'add':
                    case 'subtract':
                    case 'multiply':
                    case 'divide': this.chooseOperation(btn.textContent); this.updateDisplay(); break;
                    case 'calculate': this.calculate(); break;
                    case 'history': this.toggleHistoryPanel(); break;
                }
            });
        });

        document.addEventListener('keydown', (event)=>{
            if(event.key>='0'&&event.key<='9'){this.appendNumber(event.key); this.updateDisplay();}
            else if(event.key=='.'){this.appendNumber('.'); this.updateDisplay();}
            else if(event.key==='+'||event.key==='-'){this.chooseOperation(event.key); this.updateDisplay();}
            else if(event.key==='*'){this.chooseOperation('×'); this.updateDisplay();}
            else if(event.key==='/'){event.preventDefault(); this.chooseOperation('÷'); this.updateDisplay();}
            else if(event.key==='Enter'||event.key==='='){this.calculate();}
            else if(event.key==='Escape'||event.key==='Delete'){this.clear();}
            else if(event.key==='Backspace'){this.delete(); this.updateDisplay();}
            else if(event.key==='%'){this.percentage(); this.updateDisplay();}
        });
    }
}

document.addEventListener('DOMContentLoaded',()=>{new Calculator();});
</script>

</body>
</html>
